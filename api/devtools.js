(function(){if(window.__miniDevTools){alert("DevTools UIは既に開いています");return;}window.__miniDevTools=true;let previousHTML="",previousJS="",isDarkTheme=true;const style=document.createElement("style");function applyTheme(){style.textContent=`body{overflow:hidden !important;}#miniDevTools{position:fixed;bottom:0;right:0;width:600px;height:100vh;background:${isDarkTheme ? "#1e1e1e" : "#fff"};color:${isDarkTheme ? "#d4d4d4" : "#111"};font-family:Consolas,monospace;font-size:13px;box-shadow:0 0 10px black;z-index:999999999;display:flex;flex-direction:column;overflow:hidden;border-radius:8px}#miniDevTools *{box-sizing:border-box}#miniDevToolsHeader{display:flex;background:${isDarkTheme ? "#333" : "#ddd"};border-bottom:1px solid ${isDarkTheme ? "#444" : "#ccc"}}#miniDevToolsHeader button{flex:1;padding:8px;background:${isDarkTheme ? "#333" : "#ddd"};border:none;color:${isDarkTheme ? "#d4d4d4" : "#111"};cursor:pointer}#miniDevToolsHeader button.active{background:#007acc}#miniDevToolsContent{flex:1;display:flex;flex-direction:column;overflow:hidden}#miniDevToolsContent>div{flex:1;display:none;flex-direction:column;overflow:hidden}#miniDevToolsContent>div.active{display:flex}#elementsTextarea,#sourceTextarea,#consoleInput{width:100%;height:100%;background:${isDarkTheme ? "#1e1e1e" : "#fff"};border:1px solid ${isDarkTheme ? "#555" : "#bbb"};color:${isDarkTheme ? "#d4d4d4" : "#111"};resize:none;font-family:Consolas,monospace;font-size:13px}#consoleOutput{height:150px;background:${isDarkTheme ? "#252526" : "#eee"};color:${isDarkTheme ? "#d4d4d4" : "#111"};overflow-y:auto;border:1px solid ${isDarkTheme ? "#555" : "#bbb"};margin-top:4px;padding:4px;font-family:Consolas,monospace;font-size:13px}#consoleRunBtn,#applyElementsBtn,#applySourceBtn,#closeBtn,#restoreElementsBtn,#restoreSourceBtn,#themeToggleBtn{margin-top:4px;padding:6px 12px;background:#007acc;border:none;color:white;cursor:pointer;font-weight:bold}#closeBtn{background:#cc3300;margin-top:2px}#sourceList{height:150px;overflow-y:auto;background:${isDarkTheme ? "#252526" : "#eee"};border:1px solid ${isDarkTheme ? "#555" : "#bbb"};margin-bottom:6px;font-family:Consolas,monospace;font-size:12px}#sourceList div{padding:4px;border-bottom:1px solid ${isDarkTheme ? "#444" : "#ccc"};cursor:pointer}#sourceList div.selected{background:#007acc;color:white}`}document.head.appendChild(style);applyTheme();const panel=document.createElement("div");panel.id="miniDevTools";const header=document.createElement("div");header.id="miniDevToolsHeader";const tabs=["Elements","Console","Sources"];const tabButtons={};tabs.forEach(name=>{const btn=document.createElement("button");btn.textContent=name;btn.onclick=()=>switchTab(name);header.appendChild(btn);tabButtons[name]=btn});const themeToggleBtn=document.createElement("button");themeToggleBtn.id="themeToggleBtn";themeToggleBtn.textContent="テーマ切替";themeToggleBtn.onclick=()=>{isDarkTheme=!isDarkTheme;applyTheme();};header.appendChild(themeToggleBtn);panel.appendChild(header);const content=document.createElement("div");content.id="miniDevToolsContent";const elementsDiv=document.createElement("div");elementsDiv.id="elementsTab";const elementsTextarea=document.createElement("textarea");elementsTextarea.id="elementsTextarea";elementsTextarea.value=document.body.innerHTML;previousHTML=document.body.innerHTML;const applyElementsBtn=document.createElement("button");applyElementsBtn.id="applyElementsBtn";applyElementsBtn.textContent="変更を適用";const restoreElementsBtn=document.createElement("button");restoreElementsBtn.id="restoreElementsBtn";restoreElementsBtn.textContent="元に戻す";elementsDiv.appendChild(elementsTextarea);elementsDiv.appendChild(applyElementsBtn);elementsDiv.appendChild(restoreElementsBtn);content.appendChild(elementsDiv);const consoleDiv=document.createElement("div");consoleDiv.id="consoleTab";const consoleInput=document.createElement("textarea");consoleInput.id="consoleInput";consoleInput.rows=5;consoleInput.placeholder="ここにJavaScriptコードを入力して実行できます";const consoleRunBtn=document.createElement("button");consoleRunBtn.id="consoleRunBtn";consoleRunBtn.textContent="実行";const consoleOutput=document.createElement("div");consoleOutput.id="consoleOutput";consoleDiv.appendChild(consoleInput);consoleDiv.appendChild(consoleRunBtn);consoleDiv.appendChild(consoleOutput);content.appendChild(consoleDiv);const sourcesDiv=document.createElement("div");sourcesDiv.id="sourcesTab";const sourceList=document.createElement("div");sourceList.id="sourceList";const sourceTextarea=document.createElement("textarea");sourceTextarea.id="sourceTextarea";sourceTextarea.placeholder="選択したスクリプトの内容がここに表示されます";const applySourceBtn=document.createElement("button");applySourceBtn.id="applySourceBtn";applySourceBtn.textContent="スクリプトを更新";const restoreSourceBtn=document.createElement("button");restoreSourceBtn.id="restoreSourceBtn";restoreSourceBtn.textContent="元に戻す";sourcesDiv.appendChild(sourceList);sourcesDiv.appendChild(sourceTextarea);sourcesDiv.appendChild(applySourceBtn);sourcesDiv.appendChild(restoreSourceBtn);const copyArea=document.createElement("div");copyArea.id="copyCodeArea";const copyPre=document.createElement("pre");copyPre.id="copyCodeText";copyPre.style.maxHeight="100px";copyPre.style.overflow="auto";copyPre.style.background="#111";copyPre.style.padding="4px";copyPre.style.color="#0f0";copyPre.style.border="1px solid #555";copyPre.style.fontSize="12px";copyPre.style.fontFamily="monospace";const copyBtn=document.createElement("button");copyBtn.textContent="コードをコピー";copyBtn.style.marginTop="4px";copyBtn.style.padding="4px 8px";copyBtn.style.background="#007acc";copyBtn.style.color="#fff";copyBtn.style.border="none";copyBtn.style.cursor="pointer";copyBtn.onclick=()=>{navigator.clipboard.writeText(copyPre.textContent).then(()=>{alert("コピーしました")})};copyArea.appendChild(copyPre);copyArea.appendChild(copyBtn);sourcesDiv.appendChild(copyArea);content.appendChild(sourcesDiv);panel.appendChild(content);const closeBtn=document.createElement("button");closeBtn.id="closeBtn";closeBtn.textContent="閉じる";closeBtn.onclick=()=>{panel.remove();style.remove();window.__miniDevTools=false;document.body.style.overflow="auto"};panel.appendChild(closeBtn);document.body.appendChild(panel);function switchTab(name){tabs.forEach(t=>{tabButtons[t].classList.toggle("active",t===name);const tabDiv=document.getElementById(t.toLowerCase()+"Tab");if(tabDiv)tabDiv.classList.toggle("active",t===name)})}switchTab("Elements");applyElementsBtn.onclick=()=>{try{const parser=new DOMParser();const newDoc=parser.parseFromString(elementsTextarea.value,"text/html");Array.from(document.body.children).forEach(el=>{if(el!==panel)el.remove()});Array.from(newDoc.body.children).forEach(el=>document.body.appendChild(el));previousHTML=elementsTextarea.value;logConsole("Elements変更を適用しました")}catch(e){alert("Elements適用エラー: "+e.message)}};restoreElementsBtn.onclick=()=>{elementsTextarea.value=previousHTML};consoleRunBtn.onclick=()=>{let code=consoleInput.value;try{let script=document.createElement('script');script.textContent=code;document.documentElement.appendChild(script);script.remove();logConsole(">> "+code)}catch(e){logConsole("⚠️ エラー: "+e.message)}};function logConsole(msg){const line=document.createElement("div");line.textContent=msg;consoleOutput.appendChild(line);consoleOutput.scrollTop=consoleOutput.scrollHeight}function refreshSourceList(){sourceList.innerHTML="";const scripts=document.querySelectorAll("script");scripts.forEach((s,i)=>{let desc=s.src?`外部: ${s.src}`:"インラインスクリプト "+(i+1);const item=document.createElement("div");item.textContent=desc;item.dataset.index=i;item.onclick=()=>{[...sourceList.children].forEach(c=>c.classList.remove("selected"));item.classList.add("selected");if(s.src){fetch(s.src).then(r=>{if(!r.ok)throw new Error(`HTTPエラー: ${r.status}`);return r.text()}).then(txt=>{sourceTextarea.value=txt;previousJS=txt;copyPre.textContent=txt}).catch(err=>{const msg="// 読み込み失敗: "+err.message;sourceTextarea.value=msg;copyPre.textContent=msg})}else{sourceTextarea.value=s.textContent;previousJS=s.textContent;copyPre.textContent=s.textContent}};sourceList.appendChild(item)})}refreshSourceList();applySourceBtn.onclick=()=>{const selected=sourceList.querySelector(".selected");if(!selected){alert("スクリプトを選択してください");return}const idx=Number(selected.dataset.index);const scripts=document.querySelectorAll("script");const target=scripts[idx];try{const newScript=document.createElement("script");newScript.textContent=sourceTextarea.value;if(target.parentNode){target.parentNode.replaceChild(newScript,target);}alert("スクリプトを更新しました（一時的に変更されます。リロードで元に戻ります）");previousJS=sourceTextarea.value}catch(e){alert("更新エラー: "+e.message)}};restoreSourceBtn.onclick=()=>{sourceTextarea.value=previousJS}})();
